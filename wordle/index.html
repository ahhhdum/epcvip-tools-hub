<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
  <title>Wordle Battle - EPCVIP</title>
  <link rel="stylesheet" href="wordle.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>Wordle Battle</h1>
      <p class="tagline">Race to solve the word!</p>
    </header>

    <!-- Lobby View -->
    <div id="lobby" class="view">
      <div class="lobby-content">
        <!-- Auth Section -->
        <div id="authSection" class="auth-section">
          <!-- When NOT logged in -->
          <div id="authPrompt" class="auth-prompt">
            <p class="auth-message">
              <strong>Login to save your stats!</strong><br>
              <span class="auth-submessage">Track your wins, streaks, and compete on leaderboards.</span>
            </p>
            <div class="auth-buttons">
              <button id="loginBtn" class="btn btn-primary">Login</button>
              <button id="signupBtn" class="btn btn-secondary">Sign Up</button>
            </div>
            <p class="guest-option">or <a href="#" id="playAsGuest">play as guest</a></p>
          </div>

          <!-- When logged in -->
          <div id="authStatus" class="auth-status hidden">
            <span class="auth-check">‚úì</span>
            <span class="user-info"><strong id="userEmail"></strong></span>
            <button id="logoutBtn" class="btn-link">Logout</button>
          </div>
        </div>

        <!-- Stats display (only for authenticated users) -->
        <div id="playerStats" class="player-stats hidden">
          <div class="stats-row">
            <div class="stat">
              <span class="stat-value" id="statPlayed">0</span>
              <span class="stat-label">Played</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="statWinRate">0%</span>
              <span class="stat-label">Win %</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="statStreak">0</span>
              <span class="stat-label">Streak</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="statBestStreak">0</span>
              <span class="stat-label">Best</span>
            </div>
          </div>
        </div>

        <!-- Daily Challenge Section -->
        <div id="dailyChallengeSection" class="daily-challenge-section hidden">
          <button id="dailyChallengeBtn" class="btn btn-daily" disabled>
            Daily Challenge #<span id="dailyNum">---</span>
          </button>
          <button id="historicalDailiesBtn" class="btn btn-historical hidden">
            üìÖ Historical Dailies
          </button>
          <p id="dailyGuestMsg" class="daily-guest-msg">Login to play Daily Challenge</p>
        </div>

        <!-- Room actions (hidden until auth choice made) -->
        <div id="roomActionsSection" class="room-actions-section hidden">
          <div class="name-input">
            <label for="playerName">Your Name</label>
            <input type="text" id="playerName" placeholder="Enter your name" maxlength="20" autocomplete="off">
          </div>

          <div class="divider-or">
            <span>or create a custom game</span>
          </div>

          <div class="room-actions">
            <button id="createRoom" class="btn btn-secondary">Create Room</button>

            <div class="divider">
              <span>or</span>
            </div>

            <div class="join-section">
              <input type="text" id="roomCodeInput" placeholder="Room Code" maxlength="6" autocomplete="off">
              <button id="joinRoom" class="btn btn-secondary">Join</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Waiting Room View -->
    <div id="waiting" class="view hidden">
      <div class="waiting-content">
        <div class="room-code-display">
          <span class="label">Room Code</span>
          <span id="roomCode" class="code">------</span>
          <button id="copyCode" class="btn-icon" title="Copy code">üìã</button>
        </div>

        <div class="mode-selector">
          <label>Game Mode</label>
          <div class="mode-buttons">
            <button id="modeCasual" class="mode-btn active" data-mode="casual">Casual</button>
            <button id="modeCompetitive" class="mode-btn" data-mode="competitive">Competitive</button>
          </div>
        </div>

        <div class="word-mode-selector">
          <label>Word Selection <span id="dailyNumber" class="daily-number hidden"></span></label>
          <div class="mode-buttons">
            <button id="wordModeDaily" class="mode-btn active" data-mode="daily">Daily Challenge</button>
            <button id="wordModeRandom" class="mode-btn" data-mode="random">Random</button>
          </div>
        </div>

        <div class="player-list">
          <h3>Players <span id="playerCount" class="player-count">(0)</span></h3>
          <ul id="players"></ul>
        </div>

        <div class="ready-section">
          <button id="readyBtn" class="btn btn-ready">I'm Ready</button>
        </div>

        <div class="waiting-actions">
          <button id="startGame" class="btn btn-primary hidden disabled">Start Game</button>
          <p id="waitingMessage" class="waiting-msg">Waiting for host to start...</p>
        </div>

        <button id="leaveRoom" class="btn btn-danger">Leave Room</button>
      </div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdownOverlay" class="countdown-overlay hidden">
      <div class="countdown-content">
        <span id="countdownNumber" class="countdown-number">3</span>
      </div>
    </div>

    <!-- Game View -->
    <div id="game" class="view hidden">
      <div class="game-layout">
        <!-- Opponent boards (left side) -->
        <div class="opponents-panel">
          <h3>Opponents</h3>
          <div id="opponentBoards"></div>
        </div>

        <!-- Main game area (center) -->
        <div class="main-game">
          <div class="timer-display">
            <span id="gameTimer">0:00</span>
          </div>

          <div id="grid" class="grid"></div>

          <div id="message" class="game-message"></div>

          <div id="keyboard" class="keyboard">
            <div class="keyboard-row">
              <button data-key="Q">Q</button>
              <button data-key="W">W</button>
              <button data-key="E">E</button>
              <button data-key="R">R</button>
              <button data-key="T">T</button>
              <button data-key="Y">Y</button>
              <button data-key="U">U</button>
              <button data-key="I">I</button>
              <button data-key="O">O</button>
              <button data-key="P">P</button>
            </div>
            <div class="keyboard-row">
              <button data-key="A">A</button>
              <button data-key="S">S</button>
              <button data-key="D">D</button>
              <button data-key="F">F</button>
              <button data-key="G">G</button>
              <button data-key="H">H</button>
              <button data-key="J">J</button>
              <button data-key="K">K</button>
              <button data-key="L">L</button>
            </div>
            <div class="keyboard-row">
              <button data-key="ENTER" class="key-wide key-enter">ENTER</button>
              <button data-key="Z">Z</button>
              <button data-key="X">X</button>
              <button data-key="C">C</button>
              <button data-key="V">V</button>
              <button data-key="B">B</button>
              <button data-key="N">N</button>
              <button data-key="M">M</button>
              <button data-key="BACKSPACE" class="key-wide">‚å´</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results View -->
    <div id="results" class="view hidden">
      <div class="results-content">
        <h2>Game Over!</h2>

        <div class="word-reveal">
          <span class="label">The word was</span>
          <span id="revealedWord" class="revealed-word">-----</span>
        </div>

        <div class="leaderboard">
          <h3>Results</h3>
          <ol id="resultsList"></ol>
        </div>

        <div class="results-actions">
          <button id="playAgain" class="btn btn-primary">Play Again</button>
          <button id="backToLobby" class="btn btn-secondary">Back to Lobby</button>
        </div>
      </div>
    </div>

    <!-- Daily Challenge Completed View -->
    <div id="dailyCompleted" class="view hidden">
      <div class="daily-completed-content">
        <h2>Daily Challenge #<span id="completedDailyNum">---</span></h2>
        <p class="completed-status">Completed Today</p>

        <div id="completedGridContainer" class="completed-grid-container">
          <!-- Grid will be built dynamically -->
        </div>

        <div class="completion-stats">
          <div class="stat-item">
            <span class="stat-value" id="completedGuesses">-</span>
            <span class="stat-label">guesses</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="completedTime">-</span>
            <span class="stat-label">time</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="completedResult">-</span>
            <span class="stat-label">result</span>
          </div>
        </div>

        <div class="completion-actions">
          <button id="playRandomInstead" class="btn btn-primary">Play Random Game</button>
          <button id="backFromDaily" class="btn btn-secondary">Back to Lobby</button>
        </div>
      </div>
    </div>

    <!-- Historical Dailies View -->
    <div id="historicalDailies" class="view hidden">
      <div class="historical-content">
        <h2>Historical Dailies</h2>
        <p class="historical-subtitle">Play past daily challenges you may have missed</p>

        <!-- Quick Play Section -->
        <div class="quick-play-section">
          <button id="randomUnplayedBtn" class="btn btn-primary btn-large">
            üé≤ Random Unplayed Daily
          </button>
          <p id="randomUnplayedInfo" class="quick-play-info"></p>
        </div>

        <!-- Recent Section -->
        <div class="recent-section">
          <h3>Recent</h3>
          <div id="recentDailiesList" class="recent-dailies-list">
            <!-- Will be populated dynamically -->
          </div>
        </div>

        <!-- Browse Section -->
        <div class="browse-section">
          <h3>Browse All</h3>
          <div class="browse-controls">
            <input type="number" id="browseDailyNumber" placeholder="Daily #" min="1" class="browse-input">
            <button id="browseGoBtn" class="btn btn-secondary">Go</button>
          </div>
          <p class="browse-range" id="browseRange">Enter a daily number between 1 and ---</p>
        </div>

        <button id="backFromHistorical" class="btn btn-link">‚Üê Back to Lobby</button>
      </div>
    </div>

    <!-- Historical Daily Mode Modal (same as daily but for historical) -->
    <div id="historicalModeModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content daily-mode-modal">
        <h2>Daily #<span id="historicalModalNum">---</span></h2>
        <p class="historical-modal-date" id="historicalModalDate"></p>

        <div class="mode-options">
          <button id="historicalSoloBtn" class="mode-option-btn primary">
            <span class="mode-icon">üéØ</span>
            <span class="mode-title">Play Solo</span>
            <span class="mode-desc">Start immediately</span>
          </button>

          <button id="historicalMultiBtn" class="mode-option-btn secondary">
            <span class="mode-icon">üë•</span>
            <span class="mode-title">Play with Friends</span>
            <span class="mode-desc">Create room & share code</span>
          </button>
        </div>

        <button id="cancelHistoricalMode" class="btn btn-link">Cancel</button>
      </div>
    </div>

    <!-- Connection status -->
    <div id="connectionStatus" class="connection-status">
      <span class="status-dot"></span>
      <span class="status-text">Connecting...</span>
    </div>

    <!-- Error toast -->
    <div id="errorToast" class="toast hidden"></div>

    <!-- Login/Signup Modal -->
    <div id="authModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <h2 id="modalTitle">Login</h2>
        <form id="authForm">
          <div class="form-group">
            <input type="email" id="authEmail" placeholder="Email" required autocomplete="email">
          </div>
          <div class="form-group">
            <input type="password" id="authPassword" placeholder="Password" required autocomplete="current-password">
          </div>
          <div class="form-group hidden" id="displayNameGroup">
            <input type="text" id="authDisplayName" placeholder="Display Name" autocomplete="name">
          </div>
          <p id="authError" class="error-message hidden"></p>
          <div class="modal-buttons">
            <button type="submit" id="authSubmit" class="btn btn-primary">Login</button>
            <button type="button" id="closeModal" class="btn btn-secondary">Cancel</button>
          </div>
        </form>
        <p id="authToggle" class="auth-toggle">
          Don't have an account? <a href="#" id="switchToSignup">Sign up</a>
        </p>
      </div>
    </div>

    <!-- Daily Mode Selection Modal -->
    <div id="dailyModeModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content daily-mode-modal">
        <h2>Daily Challenge #<span id="modalDailyNum">---</span></h2>

        <div class="mode-options">
          <button id="playSoloBtn" class="mode-option-btn primary">
            <span class="mode-icon">üéØ</span>
            <span class="mode-title">Play Solo</span>
            <span class="mode-desc">Start immediately</span>
          </button>

          <button id="playWithFriendsBtn" class="mode-option-btn secondary">
            <span class="mode-icon">üë•</span>
            <span class="mode-title">Play with Friends</span>
            <span class="mode-desc">Create room & share code</span>
          </button>
        </div>

        <button id="cancelDailyMode" class="btn btn-link">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Supabase configuration (shared with Tools Hub - epcvip-auth project) -->
  <script>
    // Same Supabase project as Tools Hub for unified auth
    window.SUPABASE_CONFIG = {
      url: 'https://yuithqxycicgokkgmpzg.supabase.co',
      anonKey: '' // Set via SUPABASE_ANON_KEY environment variable
    };
    // Allow override from environment (for Railway deployment)
    if (typeof SUPABASE_ANON_KEY !== 'undefined') {
      window.SUPABASE_CONFIG.anonKey = SUPABASE_ANON_KEY;
    }

    // Multiplayer server (same origin)
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    window.MULTIPLAYER_SERVER = `${protocol}//${window.location.host}`;
  </script>

  <script type="module" src="wordle.js"></script>
</body>
</html>
